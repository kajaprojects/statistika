---
title: "NalogaStatistika"
author: "Kaja Praprotntnik"
date: "2023-09-01"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#1. naloga
Merimo čas izvajanja računalniškega programa. Izvedemo 1000 merjenj in ugotovimo, da je čas izvajanja programa normalno porazdeljen s povprečjem 7 sekund in standardnim odklonom 0.5 sekunde.

##1a. 
Kakšna je verjetnost, da bo čas izvajanja programa večji od 8 sekund

##Odgovor: 
Verjetnost, da bo čas izvajanja večji od 8 sekund je 0.02275013.

```{r 1}
##CDF lahko izracunamo s pnorm(), 
#CDF je komulativna fja verjetnosti x, - to so prispevki do x (se pravi koliko je verjetnosti, da zavzema vrednosti manjše ali enake x. Torej, ce zelimo dobiti verjetnost, da spremenljivka zavzema vrednosti večje od x, odštejemo cdf od 1)
1 - pnorm(8, mean=7, sd=0.5)

```
##1b. 
Kakšna je verjetnost, da bo čas izvajanja programa med 7 in 8 sekund?

##Odgovor: 
Verjetnost, da bo cas izvajanja programa med 7 in 8 sekund je 0.4772499.

```{r 2}
#Za izracun verjetnosti da bo cas izvajanja programa med 7 in 8 sekund izracunamo najprej cdf od 8 (s pomocjo pnorm()), da dobimo verjetnost da spremenljivka zavzema vrednosti do 8, nato pa temu odstejemo cdf od 7, da dobimo ravno verjetnost, da spremenljivka zavzema vrednosti med 7 in 8.
pnorm(8, mean=7, sd=0.5)-pnorm(7, mean=7, sd=0.5)
```
##1c. 
Kakšen je čas izvajanja programa, ki je presežen v 90% meritev?

##Odgovor: 
Čas izvajanja programa, ki je presežen v 90% meritev je 6.359224 sekund.

```{r 3}
# Ce zelimo izracunati cas izvajanja programa, ki je presezen v 90% meritev, moramo poiskati 10. percentil z uporabo funkcije qnorm().
qnorm(0.10, mean = 7, sd=0.5)

```
##1d. 
Kakšen bi moral biti izmerjeni standardni odklon, da bi lahko trdili, da je v 99.9% primerov čas izvajanja manjši od 8 sekund?

```{r 4}

#z_value = qnorm(verj)
#SE <- (m - mu_0) / z_value

```

#2. Naloga
V datoteki dn_srcni_utripi_telovadba.txt imamo zbrane podatke o meritvah povprečnih srčnih
utripov študentov pri športni vzgoji. Podatki so zbrani glede na tip športa in glede na spol
študentov. Analizirajte podatke na naslednji način:

```{r 5}
data_telovadba = read.csv('C:\\Users\\Kaja\\Desktop\\faks\\slovenska_statistika\\dn_srcni_utripi_telovadba.csv')

```

```{r 6}
library(dplyr)
library(Rmisc)
library(ggplot2)
#library(tidyr)

```
##2a.
Ocenite povprečja in variance srčnih utripov glede na šport. Pri tem izračunajte še
intervale zaupanja v oceno parametrov

##Odgovor: 
Za izračun ocen povprecja, sem najprej grupirala podatke po tipu sporta in nato uporabila ddply funkcijo, ki applay-a funkcijo mean glede na srcni utrip v posamezni skupini, za izracun povprecja. Prav tako varianco. V spodnji tabeli lahko vidimo povprecja in varianco glede na posamezno skupino sporta.
Tako smo dobili, da je pri meritvah pri sportu BADMINTON povprcno izmerjen utrip popoulacije 142,5, to pa je zajeto na podatkih v intervalu [139, 146]. Znotraj tega intervala, lahko trdimo, da bo znotraj lezalo populacijsko povprecje z veliko verjetnostjo.

```{r d7}

dt <- data.frame(data_telovadba, group = data_telovadba$TIP_SPORTA)
ddply(dt,~group,summarise,mean=mean(SR_UTRIP),var=var(SR_UTRIP), n = length(SR_UTRIP), sd_utrip = sd(SR_UTRIP), stde = qt(0.975, n - 1)*sd_utrip / sqrt(n), leva_vrednost = mean - stde, desna_vrednost = mean + stde)


```



```{r 7}
#alternativa, ki je nisem uporabila, lahko pa s to funkcijo prav tako dobimo povprecje in intervale
ci_posportih = group.CI(SR_UTRIP ~ TIP_SPORTA, data_telovadba)
print(ci_posportih)
```
##2b. 
Izrišite na skupnem grafu diagrame okvirjev z ročaji za vsak šport.
Kaj lahko ugotovite iz grafa? 

##Odgovor: 
Iz grafa lahko razberemo povprecja meritev srcnih utripov za vsako skupino sporta, prav tako lahko primerjamo skupine med sabo in ugotovimo ali se statisticno znacilno paroma razlikujejo, prav tako lahko opazimo, da podatki niso normalno porazdeljeni(mediane niso na sredini skatel).

```{r d8}
#Izrisemo diagrame okvirjev z rocaji z ggplot
ggplot(data_telovadba, aes(x = TIP_SPORTA, y = SR_UTRIP)) +
  geom_boxplot() +
  labs(x = "Sport", y = "SR_UTRIP") +
  ggtitle("Diagrami okvirjev z rocaji za srcni utrip po sportih")
```
##2c. 
Ugotovite, ali se intenzivnosti vadbe glede na izmerjeni srcni utrip statistično značilno
razlikujejo glede na posamezne sporte. To izvedite tako, da paroma primerjajte
meritve srcnih utripov med posameznimi sporti. Predpostavite normalno porazdelitev
vzorcev.

## Odgovor:
Glede na to, da imamo izrisani graf okvir z rocaji in predpostavljamo normalno porazdelitev vzorcev, lahko iz njega razberemo ali so paroma meritve srcnih utripov statisticno znacilne. In sicer, pogledamo ce mediana prve skupine ne seka skatle druge skupine, potem lahko recemo, da se ti dve skupini statisticno znacilno razlikujeta po meritvah. Torej, v nasem primeru:
  1) BADM in FIT:
    Mediana BADM skupine seka skatlo FIT skupine, torej lahko recemo, da se ti dve     skupini po intenzivnosti vadbe statisticno znacilno NE razlikujeta po             meritvah,     če gledamo le glede na diagram okvirjev z ročaji.
  2) FIT in KOS:
    Mediana FIT skupine ne seka skatle KOS skupine, torej lahko recemo, da se ti      dve skupini po intenzivnosti vadbe statisticno znacilno razlikujeta po            meritvah, če gledamo le glede na diagram okvirjev z ročaji.
  3) KOS in NOG: Mediana KOS skupine seka skatlo NOG skupine, torej lahko rečemo,     da se ti dve skupini po intenzivnosti vadbe statisticno znacilno NE               razlikujeta po meritvah, če gledamo le glede na diagram okvirjev z ročaji.
  4) NOG in ODB: Mediana NOG skupine seka skatlo ODB skupine, torej lahko recemo,     da se ti dve skupini po intenzivnosti vadbe statistično znacilno NE               razlikujeta po meritvah, če gledamo le glede na diagram okvirjev z ročaji.




##2d. 
Pri odbojki in fitnesu ugotovite, ali obstajajo statisticno znacilne razlike med spoloma. Predpostavite normalno porazdelitev vzorcev.

##Odgovor: 
Pri odbojki lahko opazimo, da mediana prve skupine ne seka skatle druge skupine, tako da lahko recemo da se statisticno znacilno razlikujeta po meritvah, torej, obstajajo statistične značilne razlike med spoloma.
Pri fitnesu pa lahko opazimo, da mediana prve skupine seka skatlo druge skupine, tako da lahko recemo da se statisticno znacilno ne razlikujeta po meritvah, torej, ne obstajajo statisticno znacilne razlike med spoloma.

```{r 8}
df_grp_odbojka = data_telovadba %>% filter(TIP_SPORTA == "ODB")

#Izrisemo diagrame okvirjev z rocaji z ggplot
ggplot(df_grp_odbojka, aes(x = SPOL, y = SR_UTRIP)) +
  geom_boxplot() +
  labs(x = "Spol", y = "SR_UTRIP") +
  ggtitle("Diagrami okvirjev z rocaji za srcni utrip odbojka")
```

```{r 9}
df_grp_fitnes = data_telovadba %>% filter(TIP_SPORTA == "FIT")

#Izrisemo diagrame okvirjev z rocaji z ggplot
ggplot(df_grp_fitnes, aes(x = SPOL, y = SR_UTRIP)) +
  geom_boxplot() +
  labs(x = "Spol", y = "SR_UTRIP") +
  ggtitle("Diagrami okvirjev z rocaji za srcni utrip fitnes")

```


#3.Naloga
Iz podatkov iz naloge 2 ocenite intervale zaupanja v ocene povprečij, mediane in standardnega odklona po metodi večkratnega vzorčenja (ang. bootstrapping) za vsak šport.
Intervale ocenjujte na 1000 ponovitvah vzorčenja.  

## Odgovor:
Interval zaupanja je [13.62, 16.72], to pomeni, da znotraj tega intervala zajeto povprecje 130.6007, mediana in standardni odklon.

```{r tretja9}
library(boot)
```

```{r t9}
df_grp_fitnes = data_telovadba %>% filter(TIP_SPORTA == "FIT")
df_grp_fitnes

#povprecje po bootstrapu
Mboot = boot(df_grp_fitnes$SR_UTRIP,
             function(x,i) mean(x[i]), 
             R=1000)

Mboot

# Povprecje iz boostrapa.
#ena vrednost
mean(Mboot$t[,1])
#Izris histograma povprečij iz bootstrapa
hdat = data.frame(x=Mboot$t[,1])
ggplot(hdat, aes(x=x)) + 
  geom_histogram(color="black", fill="cornflowerblue", bins = 10) + theme_bw()
boot.ci(Mboot,
        conf = 0.95, 
        type = c("perc")
        )

#std po bootstrapu
std_boot = boot(df_grp_fitnes$SR_UTRIP,
             function(x,i) sd(x[i]), 
             R=1000)

# Povprečje iz boostrapa.
povprecje = mean(std_boot$t[,1])
print(povprecje)

hdat = data.frame(x=std_boot$t[,1])
ggplot(hdat, aes(x=x)) + 
  geom_histogram(color="black", fill="cornflowerblue", bins = 10) + theme_bw()

boot.ci(std_boot,
        conf = 0.95, 
        type = c("perc")
        )
```

#4. Naloga
Denimo, da izvajamo meritve casa trajanja programov (v min) za resevanje nekega problema, pri cemer uporabljamo tri metode reševanja A, B in C, pri nastavitvah parametrov 1 in 2. Za vsako kombinacijo metod in parametrov pozenemo program 10-krat in belezimo case trajanja programa. Podatki so v tabeli:

```{r c9}
#osnovna opisna statistika

cetrta_podatki <- data.frame(
  metoda = rep(c("A", "B", "C"), each = 20),
  parameter = rep(rep(c("1", "2"), each = 10), 3),
  cas = c(
    54, 49, 59, 39, 55, 47, 55, 52, 52, 54,
    25, 29, 47, 26, 28, 33, 30, 28, 27, 30,
    53, 72, 43, 56, 52, 67, 45, 72, 68, 59,
    46, 51, 33, 47, 41, 45, 47, 38, 42, 50,
    33, 30, 26, 25, 29, 31, 34, 27, 33, 28,
    18, 21, 34, 40, 24, 28, 30, 20, 18, 21
  )
)

cetrta_podatki

```

## 4a.
Naredi osnovno opisno statistiko casov izvajanja: glede na metode izvajanja, glede na nastavitve parametrov in glede na oboje skupaj. 

##Odgovor:
1. glede na metode izvajanja:
  
| glede_metodo | povprecje | mediana | std     | min | max | sum |
|--------------|-----------|---------|---------|-----|-----|-----|
| A            | 40.95     | 43      | 12.3564 | 25  | 59  | 819 |
| B            | 51.35     | 48.5    | 11.2075 | 33  | 72  | 1027 |
| C            | 27.50     | 28      | 5.9427  | 18  | 40  | 550  |


2. glede na nastavitve parametrov:

| glede_par | povprecje | mediana | std     | min | max | sum  |
|-----------|-----------|---------|---------|-----|-----|------|
| 1         | 46.63333  | 50.5    | 14.3803 | 25  | 72  | 1399 |
| 2         | 33.23333  | 30      | 10.1495 | 18  | 51  | 997  |

3. glede nametodo in parametre skupaj (vse)

| glede | povprecje | mediana | std     | min | max | sum  |
|-------|-----------|---------|---------|-----|-----|------|
| vse   | 39.93333  | 38.5    | 14.0687 | 18  | 72  | 2396 |


```{r p22}
# Osnovna opisna statistika glede na metode izvajanja

# glede nametodo in parametre skupaj 
opisna_statistika <- cetrta_podatki %>%
  summarise(
    glede = "vse",
    povprecje = mean(cas),
    mediana = median(cas),
    std = sd(cas),
    min = min(cas),
    max = max(cas),
    sum = sum(cas)
  )

#glede na metodo

stat_glede_A = cetrta_podatki %>% filter(metoda == "A")
opisna_statistika_metoda_A <- stat_glede_A %>%
  summarise(
    glede_metodo = "A",
    povprecje = mean(cas),
    mediana = median(cas),
    std = sd(cas),
    min = min(cas),
    max = max(cas),
    sum = sum(cas)
  )

stat_glede_B = cetrta_podatki %>% filter(metoda == "B")
opisna_statistika_metoda_B <- stat_glede_B %>%
  summarise(
    glede_metodo = "B",
    povprecje = mean(cas),
    mediana = median(cas),
    std = sd(cas),
    min = min(cas),
    max = max(cas),
    sum = sum(cas)
  )

stat_glede_C = cetrta_podatki %>% filter(metoda == "C")
opisna_statistika_metoda_C <- stat_glede_C %>%
  summarise(
    glede_metodo = "C",
    povprecje = mean(cas),
    mediana = median(cas),
    std = sd(cas),
    min = min(cas),
    max = max(cas),
    sum = sum(cas)
  )

#glede na parametre
stat_glede_parameter_1 = cetrta_podatki %>% filter(parameter == "1")
opisna_statistika__parameter_1 <- stat_glede_parameter_1 %>%
  summarise(
    glede_par = 1,
    povprecje = mean(cas),
    mediana = median(cas),
    std = sd(cas),
    min = min(cas),
    max = max(cas),
    sum = sum(cas)
  )

stat_glede_parameter_2 = cetrta_podatki %>% filter(parameter == "2")

opisna_statistika_parameter_2 <- stat_glede_parameter_2 %>%
  summarise(
    glede_par = 2,
    povprecje = mean(cas),
    mediana = median(cas),
    std = sd(cas),
    min = min(cas),
    max = max(cas),
    sum = sum(cas)
  )
print(opisna_statistika_metoda_A)
print(opisna_statistika_metoda_B)
print(opisna_statistika__parameter_1)
print(opisna_statistika_parameter_2)
print(opisna_statistika_metoda_C)
print(opisna_statistika)

```
##4.b.
Narisi ustrezne grafe in na podlagi grafov (!!!!) doloci ali obstajajo statisticno značilne razlike med metodami izvajanja, med nastavitvami parametrov in glede na oboje skupaj. 

##Odgovor: 
Izrisala sem grafe glede na:
1. parametre (kjer so vsi casi iz vseh metod glede na nastavitve parametrov 1 in     parametrov 2):
     Ker mediana prve skatle, ne seka druge skatle, lahko trdimo, da sta ti dve        meritvi statisticno znacilno razlicni.
2. metodo (kjer gledamo glede na metodo, se pravi vrstice v tabeli in ne razlocimo    med nastavitvami parametra 1 in parametra 2):
     Na podlagi izrisanega boxplota lahko vidimo, da mediana prve skatle ne seka       mediane druge skatle, kar lahko namiguje na to, da sta ti dve meritvi             statisticno znacilno razlicni. Vseeno pa bi bilo bolj zanesljivo narediti         statistični test (neodvisni t-test, ce so podatki normalno porazdeljeeni ali      Mann-Whitney U, če niso normalno porazdeljeni). Isto ugotovimo za drugo in        tretjo, ki mediana druge skatle ne seka tretje skatle.
3. glede na oboje (to sem naredila tako, da sem najprej filtrirala podatke za        nastavitve parametra 1 in nato gledala metode in nato filtrirala podatke za       nastavitve parametra 2 in nato gledala metode):
      a) nastavitve parametra 1 + vse metode:
            Mediana druge skatle ne seka prve skatle, prav pa tako nobena mediana             ne seka tretje skatle, tako da to lahko nakazuje moznost , da so te               meritve statisticno znacilno razlicne.
      b) nastavitve parametra 2 + vse metode:
            mediana druge skatle ne seka prve skatle in obratno, prav pa tako                 mediana tretje skatle ne seka prve skatle, tako da to lahko nakazuje              moznost, da so te meritve statisticno znacilno razlicne.
            
```{r p23}
#graf glede na vse

ggplot(stat_glede_parameter_1, aes(x = metoda, y = cas)) +
  geom_boxplot() +
  labs(x = "parameter", y = "cas") +
  ggtitle("Diagrami okvirjev z rocaji glede na oboje, parameter 1 in vse metode")

ggplot(stat_glede_parameter_2, aes(x = metoda, y = cas)) +
  geom_boxplot() +
  labs(x = "parameter", y = "cas") +
  ggtitle("Diagrami okvirjev z rocaji glede na oboje, parameter 2 in vse metode")

#graf glede na metodo
ggplot(cetrta_podatki, aes(x = metoda, y = cas)) +
  geom_boxplot() +
  labs(x = "metoda", y = "cas") +
  ggtitle("Diagrami okvirjev z rocaji glede na metodo izvajanja")

#graf glede na parametre
ggplot(cetrta_podatki, aes(x = parameter, y = cas)) +
  geom_boxplot() +
  labs(x = "parameter", y = "cas") +
  ggtitle("Diagrami okvirjev z rocaji glede na nastavitev parametrov")



```
##4.c 
Oceni intervale zaupanja v povprečne vrednosti in na podlagi intervalov zaupanja
določi (!!!!), ali obstajajo statistično značilne razlike med metodami izvajanja, med nastavitvami parametrov in glede na oboje skupaj. 

##Odgovor:

| Gledamo po     | Upper   | Mean     | Lower   |
|----------------|---------|----------|---------|
| ci_parameter2  | 37.0232 | 33.2333  | 29.4434 |
| ci_parameter1  | 52.0030 | 46.6333  | 41.2637 |
| ci_metodaA     | 46.7330 | 40.9500  | 35.1670 |
| ci_metodaB     | 56.5953 | 51.3500  | 46.1047 |
| ci_metodaC     | 30.2813 | 27.5000  | 24.7187 |
| ci_vse         | 43.5677 | 39.9333  | 36.2990 |

Iz tabele lahko pogledamo intervale zaupanja za metodo A, B in C. Če se intervali zaupanja za povprečne vrednosti med različnimi skupinami ne prekrivajo, lahko sklepamo, da obstajajo statistično značilne razlike med temi skupinami, ce pa ne pa ni nujno da je obratno. 
Ker vidimo v tabeli, da se intervali metode B in C ne prekrivajo, lahko rečemo, da to lahko nakazuje na statisticno znacilno razliko med njima. Prav tako A in C.
Za parametre pa lahko vidimo, da se intervali zaupanja prav tako ne prekrivajo, zato lahko sklepamo, da se statistično značilno razlikujeta (interval zaupanja uposteva povprecje in variabilnost podatkov v obeh skupinah).



```{r 23}
ci_parameter2 = CI(stat_glede_parameter_2$cas)
ci_parameter1 = CI(stat_glede_parameter_1$cas)
ci_metodaA = CI(stat_glede_A$cas)
ci_metodaB = CI(stat_glede_B$cas)
ci_metodaC = CI(stat_glede_C$cas)
ci_vse = CI(cetrta_podatki$cas)

print("ci_parameter2")  
print(ci_parameter2) 
print("ci_parameter1") 
print(ci_parameter1)  
print("ci_metodaA")     
print(ci_metodaA) 
print("ci_metodaB")
print(ci_metodaB)     
print("ci_metodaC")
print(ci_metodaC)     
print("ci_vse")
print(ci_vse)         

```

#5.Naloga
Napiši funkcije v R za izračun specifičnosti, senzitivnosti in točnosti, ki jih izračunaš iz
kontingenčne tabele (vhod v funkcijo). Testiraj delovanje funkcije na naslednjih podatkih: 

##Odgovor: 
Test je dober, ce sta specificnost in sensitivnost visoki. sensitivnost je v primeru podatkov iz podane kontingencne tabele 0.9659864, specificnost  0.9096045 in tocnost 0.9351852. 
```{r 24}
# Podatki iz kontingencne tabele. Uporabljamo jih ko preucujemo 2 ali vec kategorijski spremenljivki.
TP = 710  
FP = 80   
FN = 25  
TN = 805 

# Senzitivnost lahko izracunamo po formuli TP/(TP + FN). Senzitivnost meri kako nas testni postopek dobro napoveduje pozitivne referencne razrede. Sensitivnost se meri pri neuravnotezenih razredih.
senzitivnost <- function(TP, FN) {
  return(TP / (TP + FN))
}

# Specificnost lahko izracunamo po formuli TN/(FP + TN). Specificnost meri kako dobro napovedujemo negativne referencne razrede. Specificnost se meri pri neuravnotezenih razredih.
specificnost <- function(TN, FP) {
  return(TN / (TN + FP))
}

# Tocnost izracunamo po formuli (TP + TN) / N. Meri kvaliteto nasega postopka v primerjavi z referencnoi vrednostjo. Vecja kot je stevilka boljsi je test. Tocnost je dobra mera, ce so podatki uravnotezeni. Ampak odvisno kaj zelimo.
tocnost <- function(TP, TN, FP, FN) {
  return((TP + TN) / (TP + FP + FN + TN))
}

cat("Senzitivnost:", senzitivnost(TP, FN), "\n")
cat("Specificnost:", specificnost(TN, FP), "\n")
cat("Tocnost:", tocnost(TP, TN, FP, FN), "\n")
```



#6.Naloga
Zdravniki so ugotovili, da obstaja zveza med koncentracijo kreatinina v krvi in akutnim vnetjem
ledvic. Zato so zaceli meriti koncentracijo kreatinina pri pacientih. Podatki so zbrani v datoteki
dn_kreatinin_akin.txt, kjer so v prvem stolpcu meritve kreatinina, v drugem pa podatek, ali je
prišlo do akutnega vnetja ledvic ali ne. 

## 6a. 
Izvedite ROC analizo, da ugotovite, kako dobro kreatinin napoveduje vnetje ledvic. 

Fun fact: Pri ROC krivulji izracunamo vse mozne pragove/mejne vrednosti in za vsako izracunamo specificnost in senzitivnost. Visja kot je AUC vrednost, boljsi je test
Odgovor: 

##6b.
Iz grafa ROC krivulje ocenite senzitivnosti pri specifičnosti 0.8 in 0.6.
##6c.
Na podlagi ROC krivulje ugotovite mejno vrednost kreatinina, kjer dosežemo
senzitivnost večjo od 75%. 

```{r sesta a}
#TODO: preveri ce je prav
kreatinin_akin = read.csv('C:\\Users\\Kaja\\Desktop\\faks\\slovenska_statistika\\dn_kreatinin_akin.csv')

library(pROC)
roc_data = roc(kreatinin_akin$AKIN, kreatinin_akin$Kreatinin)

roc_df1 <- data.frame(
  Specificity = roc_data$specificities,
  Sensitivity = roc_data$sensitivities,
  Threshold = roc_data$thresholds
)

names(roc_df1) = c("Specificity", "Sensitivity", "Threshold")
# obrnemo zaradi izrisa
roc_df = roc_df1[order(nrow(roc_df1):1), ]
roc_df$klasifikacija = rep(1, nrow(roc_df1))

#ploscina podkrivuljo, oomejena na intervalu med 0 in 1
auc1 = roc_data$auc
auc1

# za izris identitete
ident = data.frame(x=c(0,1), y = c(0,1))

#roc_df = rbind(roc_df1, roc_df2)
roc_df$klasifikacija = as.factor(roc_df$klasifikacija)

ggplot(data=roc_df, aes(x=1-Specificity, y = Sensitivity, color = klasifikacija) ) +
  
  geom_point(size=2) + 
  geom_line(size=1) +
  
  # dodajanje identitete
  geom_line(data = ident, mapping = aes(x=x, y = y), color="steelblue", linetype="dashed") +

  theme_bw()

```


#2.del 1.Naloga
Pri kirurški operaciji srca merimo koncentracije treh markerjev, s katerimi ugotavljamo uspešnost operacije. Meritve izvajamo tako, da merimo koncentracije markerjev pred in po operaciji. Podatki so zbrani v datoteki dn_markerji_pred_po.txt.
Ugotovite, ali obstajajo statistično značilne razlike med markerji pred in po operaciji. Odgovor utemelji s statistično analizo. 

##Odgovor: 
Da lahko ugotovimo, ali obstajajo statistično značilne razlike med markerji pred in po operaciji, moramo najprej pogledati ali so podatki normalno porazdeljeni. To naredimo z testom normalnosti, Shapiro_Wilk test. Ce je p-vrednost tega testa manjsa od 0.05, potem ni normlano porazdeljeno, ce ni manjsa, potem je normalno porazdeljeno. V nasem primeru je p-value = 0.1006 spremenljivke pred_NGAL, kar je vecje od 0.05, in zato lahko recemo, da je normalno porazdeljeno. Ampak po_NGAL je p-vrednost p-value = 0.009427, kar pomeni, da ni normalno porazdeljena. 
V nasem primeru za spremenljivko pred_NGAL, moramo narediti Wilcoxonov test, ker so odvisni podatki (merimo iste ljudi pred in po operaciji) in je eden od vzorcev ne normalno porazdeljen.Koncentracije markerjev pred operacijo in koncentracije markerjev po operaciji se statisticno znacilno razlikujeta (p-value = 3.967e-12).

```{r druga_prva}
markerji= read.csv('C:\\Users\\Kaja\\Desktop\\faks\\slovenska_statistika\\dn_markerji_pred_po.csv')
markerji

shapiro.test(markerji$pred_NGAL)
shapiro.test(markerji$po_NGAL)

#parni t-test
y0 = markerji$pred_NGAL
y1 = markerji$po_NGAL

wilcox.test(markerji$pred_NGAL, markerji$po_NGAL, paired = TRUE)

```
#2. del 2.Naloga 
Preučujemo ocene študentov pri dveh predmetih Statistiki in Matematičnem modeliranju.
Študente smo prešteli po naslednjih skupinah.
Ali so ocene študentov pri obeh predmetih v kakšni relaciji?
Odgovor utemelji s statistično analizo.

##Odgovor: 
Naredili smo hi-kvadrat test, ki ga uporabljamo za ugotavljanje ali sta dve količini med seboj v enakih razmerjih. Torej, preštejemo koliko imamo kombinacij Statistika ocena 10 - Mtematično modeliranje 10, kombinacij statistika ocena 10, matematično modelliranje 8-9, itd. in ugotavljamo povezavo med predmetom Statistika in Matematično modeliranje. Uporabili smo hi-kvadrat test, ampak če bi bilo v tabeli več kot 20% celic, kjer je frekvenca manjša od 5, bi uporabili Fisherjev natančni test. Naša ničta hipoteza je: 
H_0 = Količini sta nepovezani
Ker smo dobili p-vrednost p-value = 0.002415, ki je manjša od 0.05, lahko ničto hipotezo H_0 zavrnemo in rečemo, da sta ti dve spremenljivki (predmet Statistika in Matematično modeliranje) povezani.

```{r dr25}
# ustvarimo tabelo
tdat = as.table(rbind(c(25, 17, 18, 10),   
                      c(6, 16, 4, 8),      
                      c(17, 15, 18, 11),   
                      c(13, 6, 10, 20)))   

# imenujemo vrstice in stolpce
dimnames(tdat) = list("Statistika" = c("10", "8-9", "6-7", "<6"),
                      "Matematicno modeliranje" = c("10", "8-9", "6-7", "<6"))
tdat

# naredimo hi-kvadrat test
chisq.test(tdat, correct = FALSE)


```
# 2.del 3.Naloga
Preučujemo razlike v zdravljenju ob uporabi dveh zdravil. Podatki meritev so podani v
datoteki zdravljenje.xlsx.

##2, 3.1.1 
Ugotovi, ali obstaja statistično značilna razlika med zdravili. 
  II. Izpolni tabelo s podatki:

| zdravilo | skupaj (povpr ± std. odkl) | moški (povpr ± std. odkl) | ženske (povpr ± std. odkl) |
|----------|----------------------------|---------------------------|----------------------------|
| 1        |       19.8 ± 4.87          |         20.43 ± 5.25      |        19.28 ± 4.48        |
| 2        |       18.83 ± 1.9          |         19.03 ± 1.93      |        18.58 ± 1.92        |


```{r d26}
library(readxl)
data = read_excel("C:\\Users\\Kaja\\Desktop\\faks\\slovenska_statistika\\zdravljenje.xlsx")
```


```{r druga_druga_a}
#skupaj
zdravilo1 <- data %>% filter(zdravilo == 1)
zdravilo2 <- data %>% filter(zdravilo == 2)

povprecje_zdravilo1_skupaj <- mean(zdravilo1$marker)
std_zdravilo1_skupaj <- sd(zdravilo1$marker)

povprecje_zdravilo2_skupaj <- mean(zdravilo2$marker)
std_zdravilo2_skupaj <- sd(zdravilo2$marker)

ttest_vsi <- t.test(zdravilo1$marker, zdravilo2$marker)

#paste zlepi stringe
print("Skupaj:")
print(paste("Zdravilo 1: povprecje =", povprecje_zdravilo1_skupaj, ", Std =", std_zdravilo1_skupaj))
print(paste("Zdravilo 2: povprecje =", povprecje_zdravilo2_skupaj, ", Std =", std_zdravilo2_skupaj))
print(paste("p-vrednost =", ttest_vsi$p.value))

#moski
zdravilo1_m <- zdravilo1 %>% filter(spol == 'M')
zdravilo2_m <- zdravilo2 %>% filter(spol == 'M')

povprecje_zdravilo1_m <- mean(zdravilo1_m$marker)
std_zdravilo1_m <- sd(zdravilo1_m$marker)

povprecje_zdravilo2_m <- mean(zdravilo2_m$marker)
std_zdravilo2_m <- sd(zdravilo2_m$marker)

print("Moski:")
print(paste("Zdravilo 1: povprecje =", povprecje_zdravilo1_m, ", Std =", std_zdravilo1_m))
print(paste("Zdravilo 2: povprecje =", povprecje_zdravilo2_m, ", Std =", std_zdravilo2_m))

#zenske
zdravilo1_z <- zdravilo1 %>% filter(spol == 'Z')
zdravilo2_z <- zdravilo2 %>% filter(spol == 'Z')

povprecje_zdravilo1_z <- mean(zdravilo1_z$marker)
std_zdravilo1_z <- sd(zdravilo1_z$marker)

povprecje_zdravilo2_z <- mean(zdravilo2_z$marker)
std_zdravilo2_z <- sd(zdravilo2_z$marker)

print("Zenske:")
print(paste("Zdravilo 1: povprecje =", povprecje_zdravilo1_z, ", Std =", std_zdravilo1_z))
print(paste("Zdravilo 2: povprecje =", povprecje_zdravilo2_z, ", Std =", std_zdravilo2_z))



```
##2, 3.1.2 
Preveri, ali so meritve normalno porazdeljene (ne glede na spol).

##Odgovor:
Za ugotovitev, ce so meritve normalno porazdeljene, uporabimo Shapiro-Wilk test normalnosti. Zapisemo nicto hipotezo:
H_0: Podatki so normlno porazdeljeni.
Ker je p-value = 0.1516 pri podatkih za zdravilo 1 vecja od 0.05, potem nicte hipoteze ne moremo zavrniti. Torej podatki so normalno porazdeljeni. Prav tako je  p-value = 0.411 za zdravilo 2 vecja od 0.05, zato tudi tukaj ne moremo zavrniti nicte hipoteze in ugotovimo, da so meritve pri zdravilu 2 tudi normalno porazdeljene.

```{r dr27}
#uporabimo Shapiro-Wilk test normalnosti
shapiro_test_zdravilo1 <- shapiro.test(zdravilo1$marker)
shapiro_test_zdravilo2 <- shapiro.test(zdravilo2$marker)
print("Shapiro-Wilk test za zdravilo 1:")
print(shapiro_test_zdravilo1)
print("Shapiro-Wilk test za zddravilo 2:") 
print(shapiro_test_zdravilo2)
```
##2, 3.1.3 
Ali obstaja statisticno znacilna razlika med zdravilom 1 in 2?
Kateri statisticni test si uporabil za testiranje uspesnosti zdravljenja?
Kakšna je nicta hipoteza tvojega testa?
Kaj si s tem pokazal?

##Odgovor: 
Uporabili smo parni t-test neodvisnih vzorcev, zato ker so podatki za oba zdravila normalno porazdeljeni in neodvisni. Postavimo nicto hipotezo
H_0: Zdravilo 1 in zdravilo 2 se statisticno znacilno ne razlikujeta.
Ker smo dobili p-value = 0.05651, za vse skupaj in to je malo nad =.05, ne moremo ovreči ničte hipoteze, kar pomeni, da se zdravilo 1 in zdravilo 2 statisticno znacilno ne razlikujeta. 

```{r d28}
#za vse
t_test <- t.test(zdravilo1$marker, zdravilo2$marker, var.equal = FALSE)

print(t_test)
```

#2, 3.2.1
Analiza uspešnosti zdravil glede na spol:
i. Izpolni spodnjo tabelo s številom pacientov in deležem glede na spol pri obeh
metodah:

|          | zdravilo 1 (delez v %) | zdravilo 2 (delez v %) |
|----------|------------------------|------------------------|
| moski    |         46.93          |         53.94          |
| zenske   |         53.06          |         46.05          |

#2, 3.2.2
Preveri, ali sta deleža moških in žensk pri obeh zdravilih enaka.

##Odgovor: 
Nista, delez moskih pri zdravilu 1 je 46.93 in delez moskih pri zdravilu 2 je 53.94, kar ni enako. Pri zenskah tudi ni enako in sicer 53.06 pri zdravilu 1 in 46.05 pri zdravilu 2.

```{r 29}
st_moskih_zdravilo_1 = sum(data$spol == "M" & data$zdravilo == 1)

st_moskih_zdravilo_2 = sum(data$spol == "M" & data$zdravilo == 2)

st_zensk_zdravilo_1 = sum(data$spol == "Z" & data$zdravilo == 1)

st_zensk_zdravilo_2 = sum(data$spol == "Z" & data$zdravilo == 2)

st_vseh_1 = st_zensk_zdravilo_1 + st_moskih_zdravilo_1
st_vseh_2 = st_zensk_zdravilo_2 + st_moskih_zdravilo_2

#delez moskih zdravilo 1
delez_m_1 = (st_moskih_zdravilo_1 / st_vseh_1) * 100

#delez moskih zdravilo 2
delez_m_2 = (st_moskih_zdravilo_2 / st_vseh_2) * 100

#delez zensk zdravilo 1
delez_z_1 = (st_zensk_zdravilo_1 / st_vseh_1) * 100

#delez zensk zdravilo 2
delez_z_2 = (st_zensk_zdravilo_2 / st_vseh_2) * 100

print(paste("Zdravilo 1: Moski =", delez_m_1, "%, zenske =", delez_z_1, "%\n"))
print(paste("Zdravilo 2: Moški =", delez_m_2, "%, Ženske =", delez_z_2, "%\n"))

```

#2, 3.2.3 
Preveri, ali obstajajo razlike v uspešnosti zdravljenja glede na spol pri zdravilu 1.Kateri statistični test si uporabil? Kakšna je p-vrednost?
Kaj to pomeni?

##Odgovor: 
Za preverjanje razlik v uspesnosti zdravljenja glede na spol pri zdravilu 1 sem uporabila t.test, ker sta spremenljivki neodvisni in normalno porazdeljeni.
Postavimo nicto hipotezo in sicer H_0: Skupini se statisticno znacilno ne razlikujeta. Ker je p-value = 0.2454 vecja od 0.05, ne moremo ovreci nicte hipoteze. Torej Uspesnost zdravljenja glede na spol se statisticno znacilno ne razlikuje.
```{r tretja_a_322}
shapiro_m = shapiro.test(zdravilo1_m$marker)
shapiro_m #p-value = 0.4135, se pravi je normalno porazdeljen

shapiro_z = shapiro.test(zdravilo1_z$marker)
shapiro_z # p-value = 0.2316, se pravi je normalno porazdeljen

t_test_result <- t.test(zdravilo1_m$marker, zdravilo1_z$marker, var.equal = TRUE)
t_test_result

```
#2, 3.2.4
Preveri, ali obstajajo razlike v uspešnosti zdravljenja glede na spol pri zdravilu
2.
Kateri statistični test si uporabil? Kakšna je p-vrednost?
Kaj to pomeni?

##Odgovor: 
Za preverjanje razlik v uspesnosti zdravljenja glede na spol pri zdravilu 2 sem uporabila t.test, ker sta spremenljivki neodvisni in normalno porazdeljeni.
Postavimo nicto hipotezo in sicer H_0: Skupini se statisticno znacilno ne razlikujeta. Ker je p-value = 0.1576 vecja od 0.05, ne moremo ovreci nicte hipoteze. Torej Uspesnost zdravljenja glede na spol se statisticno znacilno ne razlikuje.

```{r tretja44_a_4}
shapiro_m = shapiro.test(zdravilo2_m$marker)
shapiro_m #p-value = 0.1968, se pravi je normalno porazdeljen

shapiro_z = shapiro.test(zdravilo2_z$marker)
shapiro_z # p-value = 0.2004, se pravi je normalno porazdeljen

t_test_result <- t.test(zdravilo2_m$marker, zdravilo2_z$marker, var.equal = TRUE)
t_test_result


```
#2, 4.Naloga
Preučujemo vpliv izpostavljenosti hrupu in krvnim tlakom pri ljudeh (članek v Journal of
Sound and Vibration, vol. 151, 1991, pp. 383-394). Izmerili smo naslednje podatke:

|   y |   x |   y_2 |   x_2 |
|----:|----:|------:|------:|
|   1 |  60 |     5 |    85 |
|   0 |  63 |     4 |    89 |
|   1 |  65 |     6 |    90 |
|   2 |  70 |     8 |    90 |
|   5 |  70 |     4 |    90 |
|   1 |  70 |     5 |    90 |
|   4 |  80 |     7 |    94 |
|   6 |  90 |     9 |   100 |
|   2 |  80 |     7 |   100 |
|   3 |  80 |     6 |   100 |

##2, 4a. 
Nariši diagram raztrosa (scatter diagram) količine x (stopnja hrupa merjena v dB) in
količine y (povišanje krvnega tlaka v mmHg)? Ali lahko na podlagi diagrama
upravičeno sklepamo, da je primeren model za modeliranje odvisnosti med y in x
linearna regresija?

##Odgovor: 
Na podlagi diagrama lahko sklepamo, da je korelacija med stopnjo hrupa in povisanega krvnega tlaka pozitivno narascujoca, torej linearna regresija bi bil primeren model za modeliranje odvisnosti med y in x.

```{r druga_p55rva_b}

y <- c(1, 0, 1, 2, 5, 1, 4, 6, 2, 3)
x <- c(60, 63, 65, 70, 70, 70, 80, 90, 80, 80)

data_raztros <- data.frame(x = x, y = y)

# izris
ggplot(data_raztros, aes(x = x, y = y)) +
  geom_point(color = "blue") +
  ggtitle("diagram raztrosa") +
  xlab("x (stopnja hrupa merjena v dB)") +
  ylab("y (povišanje krvnega tlaka v mmHg)") +
  theme_bw()

```
##2, 4.b
Modeliraj y v odvisnosti z x z modelom linearne regresije. Kakšna je varianca napak (residualov)?

## Odgovor:
Varianca napak je 1.363 pri 8 stopnjah prostosti.

```{r druga6_prva_b}

LinearModel <- lm(y ~ x, data_raztros)
summary(LinearModel)

```


##2, 4.c
Izračunaj napovedano vrednost povišanja krvnega tlaka ob hrupu 85 dB

##odgovor
Racunamo odzivno spremenljivko y, pri cemer je  opsina spremenljivka x = 85. Iz zgornje naloge lahko izberemo, da je beta_0 = -8.93791 in beta_1 = 0.15711. Ce zapisemo po formuli y = beta_0 + beta_1 * x dobimo y = 4.41644, kar je nasa napovedana vrednost krvnega tlaka ob hrupu 85 dB.
```{r druga_prvad_b}

y = -8.93791 + 0.15711* 85
print(y)

```

##2, 4.d
Preveri statistično značilnost tega modela ob napaki zavrnitve ničte hipoteze α =
0.05. Kakšna je p-vrednost? Preveri tudi statistično ustreznost posameznih
parametrov.

## Odgovor
Kot vidimo, je p-vrednost je 0.01167, kar pomeni, da je statistično značilen model. Vrednost F-statistike = 10.57, kar ni ravno najboljše, ker je dosti majhna vrednost. R^2 = 0.5154, kar pomeni, da obstaja 49% variance, ki ni odvisna od našega modela, kar je slabo. Pr(>|t|) = 0.0357 pri beta_0, in Pr(>|t|) = 0.0117 pri beta_1, kar pomeni da so obe bete statistično značilno različne od 0.
```{r druga_66prva_b}
summary(LinearModel)

```
##2, 4.e
Izračunaj kolikšen delež celotne variance pokrijemo s takšnim modelom.

## Odgovor
Iz zgornje naloge lahko razberemo, da tak model pokrije 0.5154 variance.


##2, 4.f
Izriši porazdelitev napak, kvantil-kvantil diagram napak in graf Cookove razdalje in
komentiraj grafe (preveri heteroskedastičnost in normalno porazdelitev variance in
določi najbolj vplivne meritve na oceno parametrov modela.) 

## Odgovor
Iz grafa je lepo razvidno, da varianca grafov ni konstatna, kar nakazuje na HETEROSKEDASTIČNOST. Napake so dokaj normalno porazdeljene, razen dveh na levi strani grafa in ene na desni strani grafa. Iz zadnjega grafa lahko vidimo, da so najbolj vplivne meritve 5, 9 in 8.
```{r druga_56prva_b}
plot(LinearModel)
```
##2, 4.g
Odstrani 2 najbolj vplivni meritvi na oceno parametrov modela in ponovno določi
model linearne regresije ter ga primerjaj z osnovnim modelom. 

## Odgovor
Ta ima R^2 = 0.6434, kar je bolje od prejšnjega, F-statistic: 13.63, ki je večja od prejšnega, se pravi je bolje, in p-value: 0.01019, kar pomeni, da je še vedno statistično značilen in še vedno lahko napovedujemo. Prav tako sta Pr(>|t|) pri beti pod 0.05.

```{r druga456_prva_b}
cooks_d <- cooks.distance(LinearModel)

# order vrne v padajocem vrstnem redu, torej bo prvi indeks najvecja razdalja, zelimo odstraniti prvi dve
vplivne_meritve <- order(cooks_d, decreasing = TRUE)[1:2]
#zelimo izljuciti vrstice ki vsebujejo  vplivne meritve
podatki_brez_vplivnih <- data_raztros[-vplivne_meritve, ]

ponovni_model <- lm(y ~ x, podatki_brez_vplivnih)
summary(ponovni_model)
```

#2, 5.Naloga
V datoteki dn_cars.txt so podatki o porabi goriva posameznih avtomobilov (v drugem
stolpcu) in osnovne lastnosti avtomobilov. (Ker gre za že stare ameriške avtomobile, so
porabe precejšnje in podatki malo zastareli.)

##2, 5a. 
Izriši diagrame raztrosa (scatter diagram) za porabo goriva v odvisnosti od
prostornine motorja, moči motorja in navora. Iz diagramov oceni zveze med odzivno
spr. in ostalimi opisnimi spr.

##Odgovor:
Na vseh grafih izgleda, da se z navedeno opisno spremenljivko, da napovedati odvisno spremenljivko.

```{r dru624ga_prva_b}
cars <- read.delim("C:\\Users\\Kaja\\Desktop\\faks\\slovenska_statistika\\dn_cars.txt", sep = " ")

# izris
ggplot(cars, aes(x = prostornina.motorja, y = poraba.goriva)) +
  geom_point(color = "blue") +
  ggtitle("diagram raztrosa") +
  xlab("prostornina morja") +
  ylab("poraba goriva") +
  theme_bw()

# izris
ggplot(cars, aes(x = moc.motorja, y = poraba.goriva)) +
  geom_point(color = "blue") +
  ggtitle("diagram raztrosa") +
  xlab("moc motorja") +
  ylab("poraba goriva") +
  theme_bw()

# izris
ggplot(cars, aes(x = navor, y = poraba.goriva)) +
  geom_point(color = "blue") +
  ggtitle("diagram raztrosa") +
  xlab("navor") +
  ylab("poraba goriva") +
  theme_bw()
```


##2, 5b.
Določi minimalni model multiple linearne regresije za porabo goriva v odvisnosti od
prostornine motorja, moči motorja in navora. Preveri tudi interakcije med
spremenljivkami. Izdelaj podobno analizo, kot je bila izvedena na predavanjih. Oceni
statistično značilnost posameznih modelov in posameznih regresijskih parametrov.

## Odgovor:
Najprej naredimo osnovni model
```{r drug86a_prva_b}

mr <- lm(poraba.goriva ~ prostornina.motorja + moc.motorja + navor, cars) 
summary(mr)

```
 izvedemo step korak
```{r drug7a_prva_b}
mr2 = step(mr, direction = "both")


```

```{r drug676a_prva_b}

summary(mr2)

```
Izlocimo moc.motorja in navor, Pr(>|t|) > od 0.05

```{r druga_prva6873_b}

mr3 <- lm(poraba.goriva ~ prostornina.motorja, cars)
summary(mr3)

```
mr3 model ima manjso AIC vrednost, je boljsi
```{r druga_pr53va_b}

AIC(mr, mr3)

```
##2, 5.c
Analiziraj minimalni model:
###i.
izriši porazdelitev napak, kvantil-kvantil diagram napak in graf Cookove
razdalje in komentiraj grafe (preveri heteroskedastičnost in normalno
porazdelitev variance in določi najbolj vplivne meritve na oceno parametrov
modela.)

## Odgovor:
Vidimo laho, da je varianca residualov konstantna, torej je HETEROSKEDASTIČNOST, je normalna porazdelitev variance, najbolj vplivne meritve pa so: 18. 5 in 14.


###ii. 
Izračunaj stopnjo pokrivanja variance s tem modelom

##Odgovor:
R-squared =  0.793, torej pokriva 79% variance s tem modelom 
```{r druga_prv657a_b}

plot(mr3)
summary(mr3)
```
##2, 5.d
Odstrani 2 najbolj vplivne meritve na oceno parametrov minimalnega modela in
ponovno določi model multiple linearne regresije ter ga primerjaj s prejšnjim
modelom. 

## Odgovor:
R-squared:  0.8789 je vecji, se pravi pokrije vecjiprocent variance. F-statistic: 153.4 je vecji, prav tako pa je tudi p-value = 7.767e-11 manjsa od modela, kjer nismo odstranili 2 najbolj vplivni meritvi.
```{r druga_prv685a_b}
cooks_d_2 <- cooks.distance(mr3)

# order vrne v padajocem vrstnem redu, torej bo prvi indeks najvecja razdalja, zelimo odstraniti prvi dve
vplivne_meritve_2 <- order(cooks_d_2, decreasing = TRUE)[1:2]
#zelimo izljuciti vrstice ki vsebujejo  vplivne meritve
podatki_brez_vplivnih_2 <- cars[-vplivne_meritve, ]

ponovni_model_2 <- lm(poraba.goriva ~ prostornina.motorja, podatki_brez_vplivnih_2)
summary(ponovni_model_2)

```

#2, 6.Naloga
14. aprila 1912 se je potopil Titanik. Od 2228 potnikov jih je preživelo 705. V datoteki
titanic3.xls so zbrani podatki 1309 potnikov z oznakami, ali so potonili ali ne (survived=0 ali 1).
##2, 6a. 
Zanima nas, kakšna je verjetnost, da so potniki preživeli glede na to, koliko so bili stari (age), kakšnega spola so bili (sex), v katerem razredu so potovali (pclass) in ali so
potovali sami, ali z družino (alone=1 ali 0).

## Odgovor:

Moznost prezivetja glede na razred:

        1         2         3 
0.6191950 0.4296029 0.2552891 


Moznost prezivetja glede na spol:

female      male 
0.7274678 0.1909846 

       Otrocki (0-12)   Mladostniki (13-18)         Mladi (19-30) 
            0.5604396             0.4761905             0.3662651 
Srednja_leta1 (31-50) Srednja_leta2 (51-70)  Starostniki (70-100) 
            0.4087193             0.4117647             0.2500000 
            
            
Moznost prezivetja ce so potovali sami (1) ali v druzini (0)
        0         1 
0.5028902 0.3025316 

```{r druga58633_prva_b}

titanik_data <- read_excel("C:\\Users\\Kaja\\Desktop\\faks\\slovenska_statistika\\titanic3.xls")

#presteje glede na spol koliko moskih in koliko zensk 
skupno_spol <- table(titanik_data$sex)
#presteje koliko jih je prezivelo ob vsakem spolu
preziveli_spol <- table(titanik_data$sex[titanik_data$survived == 1])
#zelimo vedeti razmerje med prezivelimi in vsemi
verjetnost_przivetja_spol <- preziveli_spol / skupno_spol

#presteje glede na sami potovali
skupno_alone <- table(titanik_data$alone)
#presteje koliko jih je prezivelo ob vsakem spolu
preziveli_alone <- table(titanik_data$alone[titanik_data$survived == 1])
#zelimo vedeti razmerje med prezivelimi in vsemi
verjetnost_przivetja_alone <- preziveli_alone / skupno_alone

#presteje glede na razred 
skupno_razred <- table(titanik_data$pclass)
#presteje koliko jih je prezivelo ob vsakem razred
preziveli_razred <- table(titanik_data$pclass[titanik_data$survived == 1])
#zelimo vedeti razmerje med prezivelimi in vsemi
verjetnost_przivetja_razred <- preziveli_razred / skupno_razred


titanik_data$age_group <- cut(
  titanik_data$age,
  breaks = c(0, 12, 18, 30, 50, 70, 120),
  labels = c("Otrocki (0-12)", "Mladostniki (13-18)", "Mladi (19-30)", "Srednja_leta1 (31-50)", "Srednja_leta2 (51-70)", "Starostniki (70-100)"),
  right = FALSE
)
skupno_starost <- table(titanik_data$age_group)
preziveli_starost <- table(titanik_data$age_group[titanik_data$survived == 1])
verjetnost_przivetja_starost <- preziveli_starost / skupno_starost

print(verjetnost_przivetja_spol)
print(verjetnost_przivetja_starost)
print(verjetnost_przivetja_razred)
print(verjetnost_przivetja_alone)


```
##2, 6b. 
Iz podatkov naprej izvedi osnovno statistiko, koliko ljudi je preživelo glede na posamezne kategorije.

##Odgovor:

```{r dru4556ga_prva_b}
library(dplyr)

summary_starost_prezivetje <- titanik_data %>%
  group_by(survived) %>%
  summarise(
    mean_age = mean(age, na.rm = TRUE),
    median_age = median(age, na.rm = TRUE),
    min_age = min(age, na.rm = TRUE),
    max_age = max(age, na.rm = TRUE),
    sd_age = sd(age, na.rm = TRUE)
  )


summary_starost_prezivetje
```
##2, 6c
Nato izvedi model multiple logistične regresije, kjer je odzivna spr. survived, opisne
pa so age, sex, pclass in alone.
i. Izvedi modeliranje z vsemi opisnimi spr. skupaj.
ii. Napiši model, ki si ga dobil. Kaj pomeni ta model?
iii. Komentiraj razmerja obetov za posamezne spr.
iv. Uporabi model za napovedovanje, ali bo nekdo utonil ali ne.
v. Izvedi tudi ROC analizo

##Odgovor:
ii)
Model je narejen po enacbi log = beta_0 + beta_1 * age + beta_2 * sex + beta_3 * pclass + beta_4 * alone
Ta model nam pove, verjetnost prezivetja glede na starost, spol, razred in ce potuje sam.

```{r druga_3333prva_b}
logreg <- glm(survived ~ age + sex + pclass + alone, titanik_data, family = binomial)
summary(logreg)


```
##2, 6ciii. 
Komentiraj razmerja obetov za posamezne spr.
Pri spolu opazimo, da je Odds_Ratio = 0.08330224, kar pomeni da so obeti za preživetje pri moskem spolu približno 0.083-kratnik obetov za preživetje zensk. (ce pogledamo $(1 - OR)*100 = (1-0.083)*100)$ = 91.7% manjsa verjetnost prezivetja pri moskih kot pri zenskah. 95% CI [0.059, 0.116] ne vkljucuje 1, torej je statisticno znacilno.

(tako pogledamo za vsako spremenljivko)

sexmale      0.08330224  0.05929541   0.1156688
pclass       0.32401207  0.25834802   0.4032234
alone        0.94930141  0.68770513   1.3158123
```{r druga_p343434rva_b}
#dodala se intervale zaupanja skupaj z odds ration
exp(cbind(Odds_Ratio = coef(logreg), confint(logreg)))

```
##2, 6civ. 
Uporabi model za napovedovanje, ali bo nekdo utonil ali ne.
```{r druga_prva_b}

set.seed(123)
# Skupno število vrstic
skupno_vrstic = nrow(titanik_data)
# Naključno izberemo 70% podatkov za učni niz
train_niz = sample(1:skupno_vrstic, size = 0.7 * skupno_vrstic)
#razdelim podatke na treniranje in testiranje
train_data = titanik_data[train_niz, ]
test_data = titanik_data[-train_niz, ]

#na ucnem modelu
logreg_test <- glm(survived ~ age + sex + pclass, data = train_data, family = binomial)
summary(logreg_test)

# Napovedovanje verjetnosti na testnem nizu
predikcija <- predict(logreg_test, newdata = test_data, type = "response")
```

#2, 6cv. 
Izvedi tudi ROC analizo

```{r drug4545a_prva_b}
library(pROC)

roc_analiza = roc(test_data$survived, predikcija)

roc_analiza

```
##2, 6d. 
Izvedi še model multiple logistične regresije po koračni metodi in komentiraj kot prej.

## Odgovor:
spremenljivka alone je bila izlocena, ker ni izboljsala modela glede AIC. Pogledamo AIC, in vidimo da ima model brez alone AIC = 991.02, medtem ko ima model z alone AIC = 992.93, kar pomeni, da smo uspeli izboljsati test.
```{r druga_p565656rva_b}
# Izvedba koračne metode
step_model <- step(logreg, direction = "both")
summary(step_model)
summary(logreg)

```

#2,  7 Naloga
Preučujemo hitrost treh algoritmov glede na različne vhodne podatke. Hitrosti izvajanja
algoritmov v sekundah so podane v naslednji tabeli:

| Dan        | algo 1 | algo 2 | algo 3 |
|------------|--------|--------|--------|
| Podatki 1  | 11     | 10     | 4      |
|            | 8      | 12     | 3      |
|            | 6      | 13     | 5      |
|            | 8      | 11     | 6      |
| Podatki 2  | 9      | 7      | 5      |
|            | 10     | 8      | 8      |
|            | 10     | 11     | 6      |
|            | 12     | 9      | 7      |
| Podatki 3  | 8      | 7      | 5      |
|            | 9      | 8      | 9      |
|            | 9      | 10     | 7      |
|            | 11     | 9      | 6      |
| Podatki 4  | 4      | 9      | 7      |
|            | 5      | 6      | 6      |
|            | 3      | 8      | 6      |
|            | 5      | 8      | 5      |
| Podatki 5  | 13     | 10     | 12     |
|            | 12     | 9      | 10     |
|            | 11     | 9      | 11     |
|            | 14     | 8      | 12     |

Ugotovi, ali obstajajo statistične razlike v hitrosti izvajanja algoritmov glede na tip algoritma in glede
na vhodne podatke:
##2, 7a) 
Izriši ustrezen graf, kjer prikažeš, kako se razlikujejo hitrosti glede na tip algoritma in vhodne
podatke. 

```{r druga_7878prva_b}
library(reshape2)

tabela7 <- data.frame(
  Dan = c("Podatki 1", "Podatki 1", "Podatki 1", "Podatki 1", "Podatki 2", "Podatki 2", "Podatki 2", "Podatki 2", 
          "Podatki 3", "Podatki 3", "Podatki 3", "Podatki 3", "Podatki 4", "Podatki 4", "Podatki 4", "Podatki 4", 
          "Podatki 5", "Podatki 5", "Podatki 5", "Podatki 5"),
  algo1 = c(11, 8, 6, 8, 9, 10, 10, 12, 8, 9, 9, 11, 4, 5, 3, 5, 13, 12, 11, 14),
  algo2 = c(10, 12, 13, 11, 7, 8, 11, 9, 7, 8, 10, 9, 9, 6, 8, 8, 10, 9, 9, 8),
  algo3 = c(4, 3, 5, 6, 5, 8, 6, 7, 5, 9, 7, 6, 7, 6, 6, 5, 12, 10, 11, 12)
)
tabela7

#lahko bi namsto tega uporabila pivot longer
tabela7_spremenjena <- melt(tabela7, id.vars = "Dan", variable.name = "Algoritem", value.name = "cas")

#  izris po tipu algoritma
# Box plot
ggplot(tabela7_spremenjena, aes(x = Dan, y=cas, color=Algoritem)) + 
  geom_boxplot() +
  theme_bw() 


```
##2, 7b)
Izvedi analizo variance s postopkom dvo-enosmerne ANOVE in preveri statistično značilnost
modela z uporabo tabele ANOVA ter statistično značilnost posameznih faktorjev in
interakcije. Izpiši ustrezne rezultate analize. 

##Odgovor
Iz rezultata lahko razberemo, da imamo pri hitrost izvajanja med razlicnimi algoritmi F = 15.304 in Pr(>F) = 8.50e-06, kar kar kaze, da obstajajo statisticno znacilne razlike v hitrosti izvajanja med razlicnimi algoritmi.
Iz rezultata v hitrosti izvajanja glede na dan(oziroma tip podatkov) vidimo, da ima F value = 20.910 in Pr(>F) = 8.52e-10, kar pomeni, da kaze na to, da je statisticno znacilno razlicno v hitrosti izvajanja glede na tip podatkov (Dan).
Iz rezultatov med algoritmom in tipom podatkov lahko razberemo, da je F = 9.667 in Pr(>F) = 1.12e-07, kar kaze na to, da je vpliv tipa algoritma na hitrost izvajanja odvisen od tipa podatkov (Dan).
```{r druga_8989prva_b}

anova_model <- aov(cas ~ Algoritem + Dan + Algoritem:Dan, tabela7_spremenjena)
summary(anova_model)

```

##2, 7c) 
Preveri statistično značilnost vpliva posameznih faktorjev (tipa algoritma in vrste podatkov) s post-hoc analizo. Uporabi pravilne izbire post-hoc testov glede na število primerjav. 

##Odgovor
Uporabila sem HSD, ker sem zelela primerjati vse mozne pare in pogledati ce se katerikoli skupini statisticno razlikujeta. 
Glede na to, da je veliko rezultatov, bom interpretirala podatke za primerjavo med algoritmi in sicer, lahko razberemo, da je algoritem 2 za 0.2 krat visji v casu izvajanja od algoritma 1 in da je prilagojena p-vrednost, ki uposteva veckratne primerjave p adj = 0.8823137, vecja od 0.05, potem lahko recemo, da razlika ni statisticno znacilna. Poleg tega interval zaupanja vsebuje 0, kar nakazuje da ni statisticno znacilna.
```{r druga_prv9090a_b}
post_hoc <- TukeyHSD(anova_model)
print(post_hoc)
```

